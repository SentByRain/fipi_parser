# FIPI Parser

## Описание
Приложение является частью проекта телеграмм бота для подготовки к истории преподавателя [@sans_sensss](https://t.me/sans_sensss).

ФИПИ парсер служит для получения заданий из открытого банка заданий [ФИПИ](https://ege.fipi.ru/bank/) и дальнейшего форматирования текста.

## Установка

1. Склонируйте репозиторий к себе на устройство;
2. Установите необходимые зависимости:
```
yarn install
```
3. Запустите проект:

```
yarn dev
```

## Принцип работы кода

Код парсера разбит на 3 модуля: parser.js, text_extractor.js, task_former.js. 

### parser.js

Модуль parser.js обращается к сайту ФИПИ для получения html страницы с заданием для выбранного предмета и выбранной категории вопросов (пока что только для истории). 
Затем в полученном коде парсер находит информацию о количестве заданий в категории (пока что я не нашел как запросить у сервера число заданий, возможно в будущем найду и уберу эту дополнительную загрузку страницы).
После этого парсер заправшивает все задания на странице. Из полученной html страницы с заданиями строиться DOM-дерево. Из DOM'а получаем массив с заданиями, который затем обрабатываются модулями text_extractor и task_former.
Результат выполнения функций этих модулей записывается в JSON файл.

### text_extractor.js

Модуль служит для корректного извлечения текстовых данных задания из HTML элемента. В связи с особенностями разметки заданий корректно извлечь текст посредствои textContent не получится (будут лишние пробелы, тэги script и проч.).
Поэтому был написан рекурсивый алгоритм обхода самых глубоких потомков с последующим извлечением из них текста и его записью в массив.

### task_former.js

Модуль формирует из массива с текстом, полученного в модуле text_extractor, строку с правильным форматированием текста и разделением по категориям ответов. Заголовки категорий ответов имеют вид "ТЕКСТ КАПСОМ", варианты ответов имеют
маркер с цифрой "1) или буквой "А)".

## Результат работы

В результате получается JSON файл, содержащий набор объектов следующего вида:

```JSON
  {
    "id": 0,
    "task_text": "Установите соответствие между процессами (явлениями, событиями)
    и фактами, относящимися к этим процессам (явлениям, событиям): к каждой позиции
    первого столбца подберите соответствующую позицию из второго столбца.\n\n
    ПРОЦЕССЫ (ЯВЛЕНИЯ, СОБЫТИЯ)\nА) антиордынское восстание в Твери\n
    Б) городские восстания середины XVII в.\nВ) восстание под предводительством Е.И. Пугачёва\n
    Г) революционные события 1917 г.\n\n
    ФАКТЫ\n1) Соляной бунт\n2) осада Смоленска\n3) осада Оренбурга\n
    4) отречение Николая II от престола\n
    5) убийство ханского посла Чолхана\n6) «Кровавое воскресенье»"
  },

```

## ВАЖНО
**В текущей версии программы парсится только текст заданий, поэтому некоторые значения qkinds закомменчены до лучших времен, когда я доделаю скачивание картинок.**
